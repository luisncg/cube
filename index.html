using Unity.Netcode;
using UnityEngine;

public class TestModeInitializer : MonoBehaviour
{
    public bool autoStartHostInEditor = true;
    public GameObject playerPrefab; // Add this field to assign your player prefab
    
    void Start()
    {
        // Only auto-start when playing directly in the editor
        if (autoStartHostInEditor && Application.isEditor)
        {
            Debug.Log("Test mode: Auto-starting as host");
            
            // Check if we're not already connected
            if (NetworkManager.Singleton != null && 
                !NetworkManager.Singleton.IsClient && 
                !NetworkManager.Singleton.IsHost && 
                !NetworkManager.Singleton.IsServer)
            {
                // Start host
                NetworkManager.Singleton.StartHost();
                
                // Give a short delay to ensure everything is initialized
                Invoke("LockCursorAndFixPosition", 0.5f);
            }
        }
    }
    
    void LockCursorAndFixPosition()
    {
        // Lock cursor
        Cursor.lockState = CursorLockMode.Locked;
        Cursor.visible = false;
        Debug.Log("Cursor locked by TestModeInitializer");
        
        // Find the player and adjust height if needed
        GameObject player = GameObject.FindWithTag("Player");
        if (player != null)
        {
            // Check if player is too close to ground
            if (player.transform.position.y < 0.5f)
            {
                // Raise the player to prevent falling through
                Vector3 pos = player.transform.position;
                pos.y = 1.0f;
                player.transform.position = pos;
                Debug.Log("Adjusted player position to prevent falling");
            }
        }
    }
}
